/*!CK:635185441!*//*1447667654,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["8PKAL"]); }

__d('OauthLogin',['fbt','Cookie','Dialog','PopupWindow','ReloadPage','URI','WindowComm','XD'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('XD').XD;function j(k,l){this.provider=k;this.endpoint=l;return this;}j.prototype.login=function(k,l,m){var n=c('WindowComm').makeHandler((function(q){this._closePopup();var r=this.provider+'..'+q.oauth_token+'..'+q.oauth_token_secret;c('Cookie').set('tpa',r,0,'/');if(m)j._refreshLoginStatus();k&&k();}).bind(this)),o=c('WindowComm').makeHandler((function(q){this._closePopup();new (c('Dialog'))().setTitle(h._("\u30a8\u30e9\u30fc")).setBody(h._("{provider}\u3068\u306e\u63a5\u7d9a\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u003Cbr \/>Facebook\u306b\u76f4\u63a5\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u304b\u3001\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002",[h.param('provider',this.provider)])).setHandler(function(){l&&l();}).setButtons(c('Dialog').OK).show();}).bind(this)),p=new (c('URI'))(this.endpoint);p.setQueryData({provider:this.provider,next:n,channel_url:o,cancel_url:o,display:'popup'});this._popup=c('PopupWindow').open(p.toString(),416,468);};j.prototype._closePopup=function(){if(this._popup){this._popup.close();this._popup=null;}};j._refreshLoginStatus=function(){try{i.send({type:'refreshThirdPartyAuthStatus'});}catch(k){c('ReloadPage').now();}};f.exports=j;},null);
__d('OpenIDLogin',['fbt','Cookie','Dialog','OpenIDRequest','ReloadPage','XD'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('XD').XD,j={login:function(k,l,m,n,o){c('OpenIDRequest').context='tpa';new (c('OpenIDRequest'))().setThirdPartyLogin(true).setSuccessHandler(function(p){var q='OpenID'+'..'+p.oid+'..'+p.secret;c('Cookie').set('tpa',q,0,'/');if(!!n)j._refreshLoginStatus();l&&l();}).setErrorHandler(function(p){new (c('Dialog'))().setTitle(h._("\u30a8\u30e9\u30fc")).setBody(h._("{provider}\u3068\u306e\u63a5\u7d9a\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u003Cbr \/>Facebook\u306b\u76f4\u63a5\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u304b\u3001\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002",[h.param('provider',k)])).setButtons(c('Dialog').OK).setHandler(function(){m&&m();}).show();}).setProviderCache(o).setOpenIDUrl(k).send();},_refreshLoginStatus:function(){try{i.send({type:'refreshThirdPartyAuthStatus'});}catch(k){c('ReloadPage').now();}}};f.exports=j;},null);
__d('MultiLoginPopup',['Arbiter','CommentAdminPanelController','CSS','CurrentUser','Dialog','DOM','DTSG','Event','HTML','OauthLogin','OpenIDLogin','PopupWindow','SelectorDeprecated','URI','WidgetArbiter','WindowComm','$'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={provider:'facebook',providerCache:{},formSubmissionInterceptors:[],init:function(){c('Arbiter').subscribe('platform/socialplugins/login',function(i){h.loggedIn=!!i.user;});c('SelectorDeprecated').subscribe('close',function(i,j){c('SelectorDeprecated').setSelected(j.selector,c('SelectorDeprecated').getValue(j.selector),false);});},setProvider:function(i){h.provider=i;return this;},setProviderCache:function(i){h.providerCache=i;return this;},interceptFormSubmission:function(i,j,k,l){var m=function(n){if(n){h.detachExistingSubmissionInterceptors();if(n.fbDtsg){c('DTSG').setToken(n.fbDtsg);c('CurrentUser').getID=function(){return n.user;};}if(n.isThirdParty==="0"){c('DOM').scry(document.documentElement,'.postToProfile').forEach(function(o){c('CSS').show(o);});c('DOM').scry(document.documentElement,'.postToProfileCheckbox').forEach(function(o){if(n.postToProfileChecked==="0"){o.removeAttribute('checked');}else o.setAttribute('checked','checked');});c('DOM').scry(document.documentElement,'.viewerProfileHref').forEach(function(o){o.href=n.profileUrl;o.onclick='';});c('DOM').scry(document.documentElement,'.commentas').forEach(function(o){var p=o.id;c('DOM').replace(o,c('HTML')(n.commentAsMarkup));var q=c('$')(n.commentAsMarkupID);q.id=p;var r=c('DOM').scry(q,'a.commentaschange');r.forEach(function(s){var t=new (c('URI'))(s.getAttribute('ajaxify'));t.addQueryData({uniqid:p});s.setAttribute('ajaxify',t.toString());});});}else c('DOM').scry(document.documentElement,'.commentas').forEach(function(o){var p=o.id;c('DOM').replace(o,c('HTML')(n.commentAsMarkup));var q=c('$')(n.commentAsMarkupID);q.id=p;});c('DOM').scry(document.documentElement,'.viewerProfilePic').forEach(function(o){o.src=n.profilePic;});c('DOM').scry(document.documentElement,'.fbCommentAfterLoginButton').forEach(c('CSS').hide);c('DOM').scry(document.documentElement,'.fbCommentButton').forEach(c('CSS').show);c('DOM').scry(document.documentElement,'.fbReplyAfterLoginButton').forEach(c('CSS').hide);c('DOM').scry(document.documentElement,'.fbReplyButton').forEach(c('CSS').show);c('DOM').scry(document.documentElement,'.fbUpDownVoteAfterLogin').forEach(c('CSS').hide);c('DOM').scry(document.documentElement,'.fbUpDownVoteOption').forEach(c('CSS').show);c('DOM').scry(document.documentElement,'.closeButtonAfterLogin').forEach(c('CSS').hide);c('DOM').scry(document.documentElement,'.closeButton').forEach(c('CSS').show);c('CommentAdminPanelController').setLoggedIn(parseInt(n.user,10));c('Arbiter').inform('platform/socialplugins/login',{user:n.user},c('Arbiter').BEHAVIOR_STATE);c('WidgetArbiter').inform('platform/socialplugins/login',{user:n.user},c('Arbiter').BEHAVIOR_STATE);}};h.login(l,i,j,k,m);return false;},attachAllFormsToLogin:function(i,j){h.formSubmissionInterceptors=[];h.popupTitle=i;h.params=j;h.reattachLoginInterceptors();},reattachLoginInterceptors:function(){h.detachExistingSubmissionInterceptors();var i=['composer','fbUpDownVoteAfterLogin','closeButtonAfterLogin'],j=h.popupTitle,k=h.params,l=function(n){var o=n.getTarget();if(o.tagName.toLowerCase()==='form'&&i.some(c('CSS').hasClass.bind(null,o)))return h.interceptFormSubmission(o,j,k);},m=c('Event').listen(document.body,'submit',l,c('Event').Priority.URGENT);h.formSubmissionInterceptors.push(m);},detachExistingSubmissionInterceptors:function(){var i=h.formSubmissionInterceptors.length;for(var j=0;j<i;j++)h.formSubmissionInterceptors[j].remove();h.formSubmissionInterceptors=[];},login:function(i,j,k,l,m){if(!h.loggedIn)h._openPopup(l,m);},doOpenIDLogin:function(i,j,k){c('OpenIDLogin').login(i,h.tpaLoginCallback(j),h.tpaLoginCallback(k),false,h.providerCache);},doOauthWrapLogin:function(i,j,k){var l=new (c('OauthLogin'))(i,'/connect/oauthwrap_login.php');return l.login(h.tpaLoginCallback(j),h.tpaLoginCallback(k),false);},doTwitterLogin:function(i,j){var k=new (c('OauthLogin'))('Twitter','/connect/twitter_login.php');return k.login();},tpaLoginCallback:function(i){return (function(j,k){var l=c('DOM').create('iframe',{src:j,className:'hidden_elem'});c('DOM').appendContent(c('DOM').find(k.documentElement,'body'),l);}).bind(null,i,document);},loggedIn:false,_popup:null,_openPopup:function(i,j){var k=h.provider==='facebook'?'opener':'parent',l=c('WindowComm').makeHandler(function(t){h._closePopup();j&&j(t);},k),m=c('WindowComm').makeHandler(function(t){h._closePopup();},k),n;n=new (c('URI'))('/plugins/multi_login_popup_loggedin.php');n.setQueryData({original_next:l,original_cancel:m,iframe_src:i.iframe_src});l=n.getQualifiedURI().toString();if(h.provider==='facebook'){n=new (c('URI'))('/login.php');n.setQueryData(Object.assign(i,{display:'popup',social_plugin:'multi_login',cancel_url:m,next:l,provider:h.provider}));var o=450,p=700;this._popup=c('PopupWindow').open(n.toString(),o,p);}else if(h.provider==='twitter'){h.doTwitterLogin(l,m);}else if(h.provider==='microsoft'){h.doOauthWrapLogin(h.provider,l,m);}else if(h.provider==='openid'){var q=new (c('Dialog'))(),r=function(t){var u=q.getFormData();h.doOpenIDLogin(u.openid_url,l,m);q.hide();if(t.kill)t.kill();return false;};q.setContentWidth(350).setTitle('OpenID').setBody(c('DOM').create('form',{onsubmit:r},c('DOM').create('input',{type:'text',size:60,name:'openid_url'}))).setHandler(r).setButtons([c('Dialog').CONFIRM,c('Dialog').CANCEL]).show();}else{var s=h.provider+'.com';h.doOpenIDLogin(s,l,m);}},_closePopup:function(){if(this._popup){this._popup.close();this._popup=null;}}};f.exports=h;},null);